---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import EssaysList from '../../components/EssaysList.astro';

export async function getStaticPaths() {
    const allPosts = await getCollection("essaysCollection");

    const uniqueTopics = [...new Set(allPosts.map((post: any) => post.data.topics).flat())];

    return uniqueTopics.map((topic) => {
    const filteredPosts = allPosts.filter((post: any) => post.data.topics.includes(topic));
    return {
        params: { topic },
        props: { posts: filteredPosts },
    };
    });
}

const { topic } = Astro.params;
const { posts } = Astro.props;
---
<BaseLayout pageTitle={topic}>
  <p>Posts tagged with {topic}</p>
  <EssaysList posts={posts}/>
</BaseLayout>